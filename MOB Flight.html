<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>MOB Ê®™„Çπ„ÇØ„É≠„Éº„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞ÔºàÁ∏¶ÁßªÂãï„Çπ„É†„Éº„Ç∫ÁâàÔºâ</title>
<style>
  :root{ --bg:#05060a; --fg:#e8f0ff; --hud:#0e1220cc; --warn:#ff6b6b; }
  html,body{margin:0;height:100%;background:#000;color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Sans","Yu Gothic",sans-serif;}
  #wrap{position:fixed; inset:0; display:flex; background:#000;}
  #cv{flex:1; display:block; width:100%; height:100%; touch-action:none; background:#000;}
  .hud{position:fixed; left:0; right:0; top:0; padding:calc(env(safe-area-inset-top) + 4px) 6px 4px; display:flex; gap:6px; align-items:center; justify-content:space-between; pointer-events:none}
  .pill{background:var(--hud); backdrop-filter: blur(6px); padding:4px 8px; border-radius:999px; font-size:11px; line-height:1; display:flex; align-items:center; gap:8px; box-shadow:0 3px 12px #0008}
  .bar{height:5px; width:110px; background:#233; border-radius:6px; overflow:hidden}
  .fill{height:100%; background:linear-gradient(90deg,#42ffd9,#36a3ff,#7d5bff); width:0%}
  .ammo{min-width:60px; text-align:right}
  .ctrl{position:fixed; inset:auto; pointer-events:none}
  #stick{left:10px; bottom:calc(env(safe-area-inset-bottom) + 8px); width:120px; height:120px;}
  #fire{right:10px; bottom:calc(env(safe-area-inset-bottom) + 14px); width:90px; height:90px;}
  .joypad{pointer-events:auto; touch-action:none; position:absolute; inset:0; border-radius:999px; background:radial-gradient(90px 90px at 50% 50%, #1b2334cc, #0b0f1acc); box-shadow:0 6px 20px #000a, inset 0 0 0 2px #2d395d;}
  .knob{position:absolute; left:50%; top:50%; width:48px; height:48px; transform:translate(-50%,-50%); border-radius:999px; background:linear-gradient(#1b9cff,#1a6dd8); box-shadow:0 5px 14px #000a, inset 0 0 10px #fff4}
  .firebtn{pointer-events:auto; touch-action:none; position:absolute; inset:0; border-radius:999px; background:radial-gradient(70px 70px at 50% 50%, #2a1b1bcc, #140909cc); box-shadow:0 6px 20px #000a, inset 0 0 0 2px #5b2d2d;}
  .firebtn::after{content:"FIRE"; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); font-weight:700; letter-spacing:.06em; font-size:12px;}
</style>
</head>
<body>
<div id="wrap"><canvas id="cv"></canvas></div>

<!-- HUD -->
<div class="hud">
  <div class="pill">
    <span>‚è© Distance</span>
    <div class="bar"><div id="distFill" class="fill"></div></div>
    <span id="distTxt">0 m</span>
  </div>
  <div class="pill">
    <span>üí∞ <b id="score">0</b></span>
    <span>| Ammo</span>
    <span class="ammo" id="ammo">10 / 10</span>
    <span id="reload" style="color:var(--warn)"></span>
  </div>
  <div class="pill"><span>TapÔºöÊìçÁ∏¶ÂàáÊõø / FIREÈï∑Êäº„ÅóÔºöÂ∞ÑÊíÉ</span></div>
</div>

<!-- Controls -->
<div id="stick" class="ctrl"><div id="stickPad" class="joypad"></div><div id="stickKnob" class="knob"></div></div>
<div id="fire" class="ctrl"><div id="fireBtn" class="firebtn"></div></div>

<script>
(()=>{
/* ===== Âü∫Êú¨Ë®≠ÂÆö ===== */
const cv=document.getElementById('cv'); const ctx=cv.getContext('2d');
let W=0,H=0,DPR=1;
function fit(){
  DPR=Math.min(2,window.devicePixelRatio||1);
  const cw=window.innerWidth, ch=window.innerHeight;
  W=cw*DPR; H=ch*DPR; cv.width=W; cv.height=H;
}
fit(); addEventListener('resize',fit); addEventListener('orientationchange',fit);

/* ===== „Ç¢„Çª„ÉÉ„Éà ===== */
const IMG={ red:'1REDW.png', blue:'1BLUEW.png', orange:'1ORANGEW.png', ver:'1VERW.png', enemy:'karasu.png', coin:'coin.png' };
const images={}; for(const k in IMG){ const im=new Image(); im.src=IMG[k]; images[k]=im; }

/* ===== HUD ===== */
const HUD={ score:document.querySelector('#score'), distTxt:document.querySelector('#distTxt'), distFill:document.querySelector('#distFill'), ammo:document.querySelector('#ammo'), reload:document.querySelector('#reload') };

/* ===== ÂÖ•Âäõ ===== */
let stick={dx:0,dy:0,active:false,max:44}; let firing=false;
const stickPad=document.getElementById('stickPad'), stickKnob=document.getElementById('stickKnob');
function onStickStart(e){ e.preventDefault(); stick.active=true; onStickMove(e); }
function onStickMove(e){ if(!stick.active)return; const p=('touches'in e?e.touches[0]:e);
  const r=stickPad.getBoundingClientRect(), cx=r.left+r.width/2, cy=r.top+r.height/2;
  let dx=p.clientX-cx, dy=p.clientY-cy, m=Math.hypot(dx,dy), lim=stick.max;
  if(m>lim){ dx=dx/m*lim; dy=dy/m*lim; }
  stick.dx=dx/lim; stick.dy=dy/lim; stickKnob.style.transform=`translate(calc(-50% + ${dx}px),calc(-50% + ${dy}px))`;
}
function onStickEnd(e){ stick.active=false; stick.dx=stick.dy=0; stickKnob.style.transform='translate(-50%,-50%)'; }
stickPad.addEventListener('touchstart',onStickStart); stickPad.addEventListener('touchmove',onStickMove); stickPad.addEventListener('touchend',onStickEnd);
stickPad.addEventListener('mousedown',onStickStart); addEventListener('mousemove',e=>stick.active&&onStickMove(e)); addEventListener('mouseup',onStickEnd);
const fireBtn=document.getElementById('fireBtn'); fireBtn.addEventListener('touchstart',()=>firing=true); fireBtn.addEventListener('touchend',()=>firing=false);
fireBtn.addEventListener('mousedown',()=>firing=true); addEventListener('mouseup',()=>firing=false);

/* ===== „Éë„É©„É°„Éº„Çø ===== */
const PLAYER_SPEED_X=290, PLAYER_SPEED_Y=330, PLAYER_VY_RESP=0.35;
const CPU_SPEED=210, BULLET_SPEED=380, EBULLET_SPEED=120;
const HP_MAX=10; const bullets=[], ebullets=[], enemies=[], coins=[];
let world={speed:125,t:0,distance:0,score:0};

/* ===== „Ç≠„É£„É©ÁîüÊàê ===== */
function makeAlly(imgKey,idx){ const im=images[imgKey]; const scale=32/im.width;
  return {sprite:im,scale,x:120+idx*24,y:H/2+idx*20,vx:0,vy:0,hp:HP_MAX,fire:{ammo:10,cd:0,reload:0},alive:true}; }
let team=[makeAlly('red',0),makeAlly('blue',1),makeAlly('orange',2),makeAlly('ver',3)];
let controlIndex=0;

/* ===== Êõ¥Êñ∞ ===== */
function step(dt){
  world.t+=dt; world.distance+=(world.speed*dt)/70;
  // ÊïµÂá∫Áèæ
  if(Math.random()<0.02) enemies.push({sprite:images.enemy,scale:32/images.enemy.width,x:W+50,y:Math.random()*H,hp:3,fireCd:1});
  // Ëá™„Ç≠„É£„É©
  const a=team[controlIndex];
  a.vx=stick.dx*PLAYER_SPEED_X;
  const targetVy=stick.dy*PLAYER_SPEED_Y;
  a.vy+= (targetVy-a.vy)*PLAYER_VY_RESP;
  a.x=Math.max(20,Math.min(W*0.8,a.x+a.vx*dt));
  a.y=Math.max(20,Math.min(H-20,a.y+a.vy*dt));
  // Â∞ÑÊíÉ
  a.fire.cd-=dt;
  if(firing&&a.fire.cd<=0&&a.fire.ammo>0){ bullets.push({x:a.x+18,y:a.y,vx:BULLET_SPEED,vy:0}); a.fire.ammo--; a.fire.cd=0.1; if(a.fire.ammo<=0){ setTimeout(()=>a.fire.ammo=10,500);} }
  // Âºæ
  for(const b of bullets){ b.x+=b.vx*dt; }
  for(const b of ebullets){ b.x+=b.vx*dt; b.y+=b.vy*dt; }
  // Êïµ
  for(const e of enemies){ e.x-=world.speed*dt; e.fireCd-=dt; if(e.fireCd<0){ ebullets.push({x:e.x,y:e.y,vx:-EBULLET_SPEED,vy:0}); e.fireCd=1; } }
  // HUD
  HUD.score.textContent=world.score|0; HUD.distTxt.textContent=`${(world.distance|0)} m`; HUD.ammo.textContent=`${a.fire.ammo} / 10`;
}

/* ===== ÊèèÁîª ===== */
function render(){
  ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H);
  for(const b of bullets){ ctx.fillStyle='#aff'; ctx.beginPath(); ctx.arc(b.x,b.y,3,0,Math.PI*2); ctx.fill(); }
  for(const b of ebullets){ ctx.fillStyle='#f88'; ctx.beginPath(); ctx.arc(b.x,b.y,3,0,Math.PI*2); ctx.fill(); }
  for(const e of enemies){ ctx.drawImage(e.sprite,e.x-16,e.y-16,32,32); }
  for(const a of team){ ctx.drawImage(a.sprite,a.x-16,a.y-16,32,32);
    ctx.fillStyle='#6f6'; ctx.fillRect(a.x-16,a.y-22,32*(a.hp/HP_MAX),3); }
}

/* ===== „É´„Éº„Éó ===== */
let last=0; function loop(ts){ if(!last) last=ts; const dt=(ts-last)/1000; last=ts; step(dt); render(); requestAnimationFrame(loop); }
requestAnimationFrame(loop);
})();
</script>
</body>
</html>
