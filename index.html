<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>Balloon Smash 30 â€“ ã‚¨ã‚¢ãƒ›ãƒƒã‚±ãƒ¼ç‰ˆï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ï¼‰</title>
<style>
  :root{
    --bg:#0b0e14; --accent:#13c4ff; --good:#34d399; --text:#e5e7eb; --muted:#9ca3af;
    --wall:#1f2a44; --wallGlow:#2a3a62;
  }
  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family: system-ui, -apple-system, "Hiragino Sans", "Yu Gothic", Roboto, Segoe UI, sans-serif;}
  #wrap{position:fixed; inset:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); display:flex; flex-direction:column;}
  #hud{flex:0 0 auto; display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.1)); backdrop-filter: blur(8px);}
  #hud .pill{padding:6px 10px; border-radius:999px; background:#111827; border:1px solid #222; font-weight:700; min-width:88px; text-align:center}
  #hud .btn{padding:8px 14px; border-radius:10px; background:#0f172a; border:1px solid #243045; font-weight:800}
  #stageWrap{position:relative; flex:1 1 auto; display:flex; align-items:center; justify-content:center; padding:10px;}
  #stage{width:100%; max-width:100vmin; aspect-ratio:1/1; background:#0a0d14; border-radius:16px; box-shadow: 0 10px 30px rgba(0,0,0,.45) inset;}
  #overlay{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;}
  .countdown{font-size:14vw; font-weight:900; text-shadow:0 6px 20px rgba(0,0,0,.6)}
  .go{color:var(--good)}
  #leader{position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6);}
  #leader .card{width:min(92vw,720px); max-height:80vh; overflow:auto; background:#0f1623; border:1px solid #233; border-radius:18px; padding:18px;}
  #leader h2{margin:0 0 8px 0; font-size:7vw; line-height:1; text-align:center}
  #leader table{width:100%; border-collapse:collapse; font-size:4.2vw}
  #leader th,#leader td{padding:8px 6px; border-bottom:1px solid #233; text-align:left}
  #leader tr.me{background:rgba(19,196,255,.08)}
  #leader .pos{width:1%;}
  #leader .score{text-align:right}
  #restart{display:none; margin-top:12px; width:100%; padding:12px; border-radius:12px; background:#162235; color:#dbeafe; font-weight:800; border:1px solid #234}
  .rankBig{font-size:16vw; font-weight:900; text-align:center; margin:4px 0 6px 0}
  .rankBig small{font-size:6vw; font-weight:700; color:#9fb3d1}
  /* ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼å¯å‹•åŸŸã‚¬ã‚¤ãƒ‰ï¼ˆä¸‹éƒ¨å¸¯ï¼‰ */
  #zoneHint{position:absolute; left:50%; transform:translateX(-50%); bottom:12px; padding:6px 10px; border-radius:10px; background:rgba(0,0,0,.35); font-size:3.6vw; color:#cbd5e1}
  @media (min-width:540px){
    #leader h2{font-size:40px}
    #leader table{font-size:18px}
    .countdown{font-size:72px}
    .rankBig{font-size:80px}
    .rankBig small{font-size:28px}
    #zoneHint{font-size:16px}
  }
</style>
</head>
<body>
<div id="wrap">
  <div id="hud">
    <div class="pill" id="timePill">TIME 30.0</div>
    <div class="pill" id="scorePill">SCORE 0</div>
    <button id="startBtn" class="btn">â–¶ ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>
  <div id="stageWrap">
    <canvas id="stage"></canvas>
    <div id="overlay"></div>
    <div id="leader">
      <div class="card">
        <div class="rankBig" id="rankBig"></div>
        <h2>é †ä½ & è¨˜éŒ²</h2>
        <table id="rankTable"></table>
        <button id="restart">ğŸ” ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      </div>
    </div>
    <div id="zoneHint">ä¸‹éƒ¨ã‚¾ãƒ¼ãƒ³ã§ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦æ‰“ã¤ï¼ˆä¸Šã«ã¯è¡Œãã¾ã›ã‚“ï¼‰</div>
  </div>
</div>

<script>
/* ====== åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ====== */
const DPR = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const timePill = document.getElementById('timePill');
const scorePill = document.getElementById('scorePill');
const startBtn = document.getElementById('startBtn');
const leader = document.getElementById('leader');
const rankTable = document.getElementById('rankTable');
const restartBtn = document.getElementById('restart');
const rankBig = document.getElementById('rankBig');

let W=0,H=0;
function resize(){
  const rect = canvas.getBoundingClientRect();
  const size = Math.floor(Math.min(rect.width, rect.height));
  W = H = size;
  canvas.width = Math.floor(W * DPR);
  canvas.height = Math.floor(H * DPR);
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
addEventListener('resize', resize, {passive:true});
resize();

/* ====== ã‚¢ã‚»ãƒƒãƒˆ ====== */
function loadImage(src){
  return new Promise((resolve)=>{
    const img = new Image();
    img.onload = ()=>resolve(img);
    img.onerror = ()=>resolve(null);
    img.src = src;
  });
}
const assets = { smasher:null, ball:null, balloon:null, bg:null };
(async ()=>{
  assets.smasher = await loadImage('smash.png'); // ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼
  assets.ball    = await loadImage('red.png');   // ãƒ›ãƒƒã‚±ãƒ¼çƒ
  assets.balloon = await loadImage('Redb.png');  // é¢¨èˆ¹ï¼ˆä»»æ„ï¼‰
  assets.bg      = await loadImage('MOBhai.png'); // èƒŒæ™¯
})();

/* ====== å®šæ•° ====== */
const GAME_TIME = 30.0; // ç§’
const BALLOON_COUNT = 30;
const WALL = {left: 10, right: ()=>W-10, bottom: ()=>H-10}; // ä¸Šã¯ç„¡ã—ï¼ˆæŠœã‘ãŸã‚‰ãƒªã‚»ãƒƒãƒˆï¼‰
const PADDLE_ZONE_TOP = ()=>H*0.72;  // ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼å¯å‹•åŸŸã®ä¸Šç«¯ï¼ˆé¢¨èˆ¹ã¨å¹²æ¸‰ã—ãªã„ï¼‰
const PADDLE_ZONE_BOTTOM = ()=>H*0.92;
const SMASHER_R = 28;
const BALL_R = 14;
const FRICTION = 0.992;             // ãƒœãƒ¼ãƒ«æ¸›è¡°
const RESET_SPEED_STOP = 25;         // ã“ã‚Œæœªæº€ã§åœæ­¢æ‰±ã„
const POP_SPEED_MIN = 220;           // é¢¨èˆ¹ãŒå‰²ã‚Œã‚‹æœ€ä½é€Ÿåº¦
const PADDLE_HIT_BOOST = 1.03;       // åå°„å¾Œã®å¾®åŠ é€Ÿ
const PADDLE_IMPART = 0.38;          // ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼ç§»å‹•é€Ÿåº¦ã®ä»˜ä¸ç‡

/* ====== çŠ¶æ…‹ ====== */
let running=false, finished=false, timeLeft=GAME_TIME, lastTs=0, score=0;
let balloons=[], smasher, ball, needResetAfterExit=false;

/* ====== CPUï¼ˆ7äººï¼‰ ====== */
const cpuNames = ['CPU-1','CPU-2','CPU-3','CPU-4','CPU-5','CPU-6','CPU-7'];
let cpuScores = {}, cpuSkill = {};
function initCPU(){
  cpuScores = {}; cpuSkill = {};
  cpuNames.forEach(n=>{
    const base = 0.6 + Math.random()*0.7;   // 0.6ã€œ1.3/ç§’
    const clutch = 0.15 + Math.random()*0.35;
    cpuSkill[n] = {base, clutch};
    cpuScores[n] = 0;
  });
}
function updateCPU(dt){
  const progress = 1 - (timeLeft/GAME_TIME);
  for(const n of cpuNames){
    const rate = cpuSkill[n].base + cpuSkill[n].clutch*progress;
    const expected = dt * rate;
    const burst = Math.random() < expected*0.35 ? 1 : 0;
    cpuScores[n] += (expected + burst);
  }
}

/* ====== åˆæœŸåŒ– ====== */
function resetLevel(){
  // é¢¨èˆ¹ã‚’å‡ä¸€ã§ç©ã‚„ã‹ã«ï¼ˆé–‹å§‹ç›´å¾Œã ã‘é€Ÿã„ç­‰ã‚’ãªãã™ï¼‰
  balloons = [];
  for(let i=0;i<BALLOON_COUNT;i++){
    const x = WALL.left + 20 + Math.random()*(W-2*WALL.left-40);
    const y = 20 + Math.random()*(H*0.60-40); // å¸¸ã«ä¸Šå´ã«é…ç½®ï¼ˆãƒ‘ãƒ‰ãƒ«å¸¯ã¨è¢«ã‚‰ãªã„ï¼‰
    const r = 16 + Math.random()*8;
    const phase = Math.random()*Math.PI*2;
    const swayAmp = 0.35 + Math.random()*0.25; // æ¨ªæºã‚Œã¯å°ã•ã‚ã§ä¸€å®š
    const drift = 8; // px/sï¼ˆå¸¸ã«ç©ã‚„ã‹ï¼‰
    balloons.push({x,y,r,alive:true,phase,swayAmp,drift});
  }
  // ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼
  smasher = {
    x: W*0.5, y: PADDLE_ZONE_BOTTOM()-8, r:SMASHER_R,
    lastX: W*0.5, lastY: PADDLE_ZONE_BOTTOM()-8, vx:0, vy:0, dragging:false, touchId:null
  };
  // ãƒœãƒ¼ãƒ«ï¼ˆæ‰‹å‰ä¸­å¤®ã‹ã‚‰ï¼‰
  ball = {x: W*0.5, y: smasher.y-36, vx: 0, vy: 0, r:BALL_R};
  needResetAfterExit = false;
}
function fullReset(){
  score = 0; timeLeft = GAME_TIME; finished=false; running=false; lastTs=0;
  initCPU(); resetLevel(); updateHUD();
}
fullReset();

/* ====== HUD ====== */
function updateHUD(){
  timePill.textContent = `TIME ${timeLeft.toFixed(1)}`;
  scorePill.textContent = `SCORE ${score}`;
}

/* ====== å…¥åŠ›ï¼šã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚° ====== */
function canvasPointFromEvent(e){
  const rect = canvas.getBoundingClientRect();
  const cx = ('touches' in e ? e.touches[0].clientX : e.clientX) - rect.left;
  const cy = ('touches' in e ? e.touches[0].clientY : e.clientY) - rect.top;
  return {x: Math.max(WALL.left+SMASHER_R, Math.min(WALL.right()-SMASHER_R, cx)),
          y: Math.max(PADDLE_ZONE_TOP()+SMASHER_R, Math.min(PADDLE_ZONE_BOTTOM()-SMASHER_R, cy))};
}
function onDown(e){
  if(!running || finished) return;
  if('touches' in e){
    if(smasher.touchId!==null) return;
    smasher.touchId = e.touches[0].identifier;
  }
  smasher.dragging = true;
  const p = canvasPointFromEvent(e);
  smasher.lastX = smasher.x; smasher.lastY = smasher.y;
  smasher.x = p.x; smasher.y = p.y;
  e.preventDefault?.();
}
function onMove(e){
  if(!smasher.dragging) return;
  if('touches' in e){
    const t = Array.from(e.touches).find(t=>t.identifier===smasher.touchId);
    if(!t) return;
  }
  const p = canvasPointFromEvent(e);
  smasher.vx = (p.x - smasher.x) * 60; // ãƒ‰ãƒ©ãƒƒã‚°é€Ÿåº¦ã‚’æ¯ç§’æ›ç®—ï¼ˆé©åº¦ã«å¼·ã‚ï¼‰
  smasher.vy = (p.y - smasher.y) * 60;
  smasher.lastX = smasher.x; smasher.lastY = smasher.y;
  smasher.x = p.x; smasher.y = p.y;
}
function onUp(e){
  if(!smasher.dragging) return;
  smasher.dragging = false;
  smasher.touchId = null;
}
canvas.addEventListener('touchstart', onDown, {passive:false});
canvas.addEventListener('touchmove',  onMove,  {passive:false});
canvas.addEventListener('touchend',   onUp,    {passive:false});
canvas.addEventListener('mousedown',  onDown);
addEventListener('mousemove', onMove);
addEventListener('mouseup',   onUp);

/* ====== ç‰©ç† ====== */
function reflectWalls(){
  if(ball.x - ball.r < WALL.left){ ball.x = WALL.left + ball.r; ball.vx *= -1; ball.vx *= 1.0; }
  if(ball.x + ball.r > WALL.right()){ ball.x = WALL.right() - ball.r; ball.vx *= -1; ball.vx *= 1.0; }
  if(ball.y + ball.r > WALL.bottom()){ ball.y = WALL.bottom() - ball.r; ball.vy *= -1; ball.vy *= 1.0; }
  if(ball.y + ball.r < 0){ needResetAfterExit = true; }
}
function collidePaddle(){
  // ã‚¨ã‚¢ãƒ›ãƒƒã‚±ãƒ¼é¢¨ï¼šé‡ãªã£ãŸã‚‰æ³•ç·šåå°„ + ãƒ‘ãƒ‰ãƒ«ç§»å‹•é€Ÿåº¦ã‚’ä¸€éƒ¨åŠ ç®—
  const dx = ball.x - smasher.x;
  const dy = ball.y - smasher.y;
  const dist = Math.hypot(dx,dy);
  const minDist = ball.r + smasher.r*0.9; // ã»ã‚“ã®å°‘ã—ç”˜ã‚
  if(dist < minDist){
    const nx = dx / (dist || 1);
    const ny = dy / (dist || 1);
    // é€Ÿåº¦ã®æ³•ç·šãƒ»æ¥ç·šåˆ†è§£
    const vDotN = ball.vx*nx + ball.vy*ny;
    // ãƒ‘ãƒ‰ãƒ«ã¸ã®æŠ¼ã—æˆ»ã—
    const overlap = (minDist - dist);
    ball.x += nx * overlap;
    ball.y += ny * overlap;
    // åå°„ï¼ˆæ³•ç·šæˆåˆ†ã‚’åè»¢ï¼‰
    ball.vx -= 2 * vDotN * nx;
    ball.vy -= 2 * vDotN * ny;
    // ãƒ‘ãƒ‰ãƒ«ã®ç§»å‹•é€Ÿåº¦ã‚’å¤šå°‘ã®ã›ã‚‹
    ball.vx += smasher.vx * PADDLE_IMPART;
    ball.vy += smasher.vy * PADDLE_IMPART;
    // è»½ããƒ–ãƒ¼ã‚¹ãƒˆ
    ball.vx *= PADDLE_HIT_BOOST;
    ball.vy *= PADDLE_HIT_BOOST;
  }
}
function updateBalloons(dt){
  // å¸¸ã«åŒã˜ç©ã‚„ã‹ãªé€Ÿåº¦ï¼ˆé–‹å§‹ç›´å¾Œã ã‘é€Ÿã„å•é¡Œã‚’æ’é™¤ï¼‰
  for(const b of balloons){
    if(!b.alive) continue;
    b.phase += dt;
    b.x += Math.sin(b.phase*1.2) * b.swayAmp; // å°ã•ãªå·¦å³æºã‚Œ
    b.y -= b.drift*dt*0.5;                    // ã‚†ã£ãã‚Šä¸Šæ–¹å‘ã¸
    // ç«¯ã§è·³ã­è¿”ã‚‰ãšã€ä½ç½®ã‚’è»½ãæˆ»ã™ï¼ˆè¦‹ãŸç›®ã®åˆ¶å¾¡ï¼‰
    if(b.x < WALL.left + b.r) b.x = WALL.left + b.r;
    if(b.x > WALL.right() - b.r) b.x = WALL.right() - b.r;
    if(b.y < 12 + b.r) b.y = 12 + b.r;
  }
}
function hitBalloons(){
  const speed = Math.hypot(ball.vx, ball.vy);
  for(const b of balloons){
    if(!b.alive) continue;
    const d = Math.hypot(ball.x - b.x, ball.y - b.y);
    if(d < ball.r + b.r){
      if(speed >= POP_SPEED_MIN){
        b.alive = false;
        score += 1;
      }
      // è²«é€šï¼ˆãƒœãƒ¼ãƒ«ã¯æ­¢ã‚ãªã„ï¼‰
    }
  }
}

/* ====== ãƒ«ãƒ¼ãƒ— ====== */
function step(ts){
  if(!lastTs) lastTs = ts;
  const dt = Math.min(0.05, (ts-lastTs)/1000);
  lastTs = ts;

  if(running && !finished){
    timeLeft = Math.max(0, timeLeft - dt);
    updateCPU(dt);
    // ãƒœãƒ¼ãƒ«ç§»å‹•
    ball.x += ball.vx * dt;
    ball.y += ball.vy * dt;

    reflectWalls();
    collidePaddle();
    updateBalloons(dt);
    hitBalloons();

    // æ¸›è¡°
    ball.vx *= FRICTION;
    ball.vy *= FRICTION;

    // åœæ­¢ or ä¸ŠæŠœã‘ã§ãƒªã‚»ãƒƒãƒˆ
    const speed = Math.hypot(ball.vx, ball.vy);
    if(speed < RESET_SPEED_STOP || needResetAfterExit){
      resetLevel();
    }

    if(timeLeft<=0){
      finishGame();
    }

    updateHUD();
  }

  render();
  requestAnimationFrame(step);
}
requestAnimationFrame(step);

/* ====== æç”» ====== */
function drawBackground(){
  if(assets.bg){
    // MOBhai.png ã‚’å…¨é¢ã«ãƒ•ã‚£ãƒƒãƒˆï¼ˆãƒˆãƒªãƒŸãƒ³ã‚°å°‘ãªã‚ï¼‰
    const iw = assets.bg.width, ih = assets.bg.height;
    const rCanvas = W/H, rImg = iw/ih;
    let dw, dh, dx, dy;
    if(rImg > rCanvas){ // ç”»åƒãŒæ¨ªé•·
      dh = H; dw = ih * rCanvas;
      const scale = H/ih; dw = iw*scale; dh = ih*scale;
    }else{
      dw = W; const scale = W/iw; dh = ih*scale;
    }
    dx = (W - dw)/2; dy = (H - dh)/2;
    ctx.drawImage(assets.bg, dx, dy, dw, dh);
  }else{
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#0e1322'); g.addColorStop(1,'#070b13');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  }
}
function drawWalls(){
  // å·¦ãƒ»å³ãƒ»ä¸‹ã«å£ï¼ˆä¸Šã¯é–‹æ”¾ï¼‰ã€‚å£ã®è‰²ã¨ç¸å–ã‚Šã§ã‚¹ãƒ†ãƒ¼ã‚¸æ„Ÿ
  ctx.save();
  ctx.strokeStyle = 'rgba(0,0,0,0)';
  ctx.lineWidth = 0;
  // å£æœ¬ä½“
  ctx.fillStyle = '#0b1222aa';
  // å·¦
  ctx.fillRect(0,0, WALL.left, H);
  // å³
  ctx.fillRect(WALL.right(),0, W - WALL.right(), H);
  // ä¸‹
  ctx.fillRect(0, WALL.bottom(), W, H - WALL.bottom());
  // å†…å´ã®å…‰
  ctx.fillStyle = 'rgba(42,58,98,0.55)';
  ctx.fillRect(WALL.left-3,0,3,H);
  ctx.fillRect(WALL.right(),0,3,H);
  ctx.fillRect(0,WALL.bottom(),W,3);
  ctx.restore();
}
function drawBalloon(b){
  if(!b.alive) return;
  if(assets.balloon){
    const d = b.r*2;
    ctx.drawImage(assets.balloon, b.x-b.r, b.y-b.r, d, d);
  }else{
    // èµ¤é¢¨èˆ¹
    const g = ctx.createRadialGradient(b.x-4,b.y-6,4,b.x,b.y,b.r);
    g.addColorStop(0,'#ffb3b3'); g.addColorStop(1,'#c1121f');
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='rgba(255,255,255,.35)';
    ctx.beginPath(); ctx.ellipse(b.x-6,b.y-8, b.r*0.35, b.r*0.22, -0.6, 0, Math.PI*2); ctx.fill();
  }
}
function drawSmasher(){
  const x = smasher.x, y = smasher.y, r = smasher.r;
  if(assets.smasher){
    const d = r*2.2;
    ctx.drawImage(assets.smasher, x-d/2, y-d/2, d, d);
  }else{
    // æ‰‡å½¢ãƒ‘ãƒ‰ãƒ«
    ctx.save();
    ctx.translate(x,y);
    ctx.fillStyle = '#2dd4bf';
    ctx.beginPath();
    ctx.arc(0,0,r,Math.PI*0.1,Math.PI*0.9,false);
    ctx.lineTo(0,0);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }
}
function drawBall(){
  if(assets.ball){
    ctx.drawImage(assets.ball, ball.x-ball.r, ball.y-ball.r, ball.r*2, ball.r*2);
  }else{
    ctx.beginPath();
    ctx.fillStyle='#ef4444';
    ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2);
    ctx.fill();
  }
}
function render(){
  ctx.clearRect(0,0,W,H);
  drawBackground();
  drawWalls();
  // é¢¨èˆ¹
  for(const b of balloons) drawBalloon(b);
  // ãƒœãƒ¼ãƒ«ã¨ã‚¹ãƒãƒƒã‚·ãƒ£ãƒ¼
  drawBall();
  drawSmasher();
}

/* ====== ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ ====== */
function showCountdown(cb){
  overlay.innerHTML = '';
  const el = document.createElement('div');
  el.className = 'countdown';
  overlay.appendChild(el);
  const seq = ['3','2','1','<span class="go">GO</span>'];
  let i=0;
  const tick = ()=>{
    el.innerHTML = seq[i++];
    if(i<seq.length){ setTimeout(tick, 700); }
    else{
      setTimeout(()=>{ overlay.innerHTML=''; cb&&cb(); }, 300);
    }
  };
  tick();
}

/* ====== çµ‚äº† ====== */
function finishGame(){
  finished = true; running = false;
  const finalCPU = cpuNames.map(n=>({name:n, score:Math.max(0, Math.round(cpuScores[n]))}));
  const me = {name:'YOU', score:score};
  const all = [me, ...finalCPU].sort((a,b)=>b.score-a.score);
  const pos = all.findIndex(p=>p.name==='YOU')+1;

  leader.style.display='flex';
  rankBig.innerHTML = `çµ‚äº†ï¼<br>ã‚ãªãŸã¯ <span style="color:#fff">${pos} ä½</span> <small>/ 8äºº</small>`;
  rankTable.innerHTML = `
    <tr><th class="pos">#</th><th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</th><th class="score">ã‚¹ã‚³ã‚¢</th></tr>
    ${all.map((p,i)=>`
      <tr class="${p.name==='YOU'?'me':''}">
        <td class="pos">${i+1}</td>
        <td>${p.name}${p.name==='YOU'?'ï¼ˆã‚ãªãŸï¼‰':''}</td>
        <td class="score">${p.score}</td>
      </tr>
    `).join('')}
  `;
  setTimeout(()=>{ restartBtn.style.display='block'; }, 3000);
}

/* ====== ã‚¹ã‚¿ãƒ¼ãƒˆ ====== */
function startGame(){
  startBtn.disabled = true;
  leader.style.display='none';
  restartBtn.style.display='none';
  fullReset();
  showCountdown(()=>{ running = true; });
}
startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);
</script>
</body>
</html>
